
<template>
  <div id="main" class="container-flud m-0 p-0">
    <!-- <p>main</p> -->
    <!-- {{UserId}} -->

    <!-- body に変数appstateとcolnumを送ってる -->
    <div id="loadingDiv">
      <svg id="logo" data-name="レイヤー 2" viewBox="0 0 801.27 348.4">
        <g data-name="レイヤー 1">
          <g data-name="グループ 4">
            <path
              d="M191.57,176.94H100.64s-.05,0-.07,0h-15.83s0,0-.01,0H4.62c-2.55,0-4.62,2.07-4.62,4.62v46.49c0,2.55,2.07,4.62,4.62,4.62H15.73l17.47,111.81c.35,2.25,2.29,3.91,4.57,3.91h120.68c2.28,0,4.22-1.66,4.57-3.91l15.91-101.84h-8.73c-.22,0-.42-.01-.62-.03l-15.08,96.54H41.72l-16.64-106.48H169.66c.17-.02,.34-.03,.52-.03h12.07c.16,0,.31,.01,.46,.02h8.86c2.55,0,4.62-2.07,4.62-4.62v-46.49c0-2.55-2.07-4.62-4.63-4.62Zm-4.63,46.49H9.25v-37.24H186.95v37.24Z"
              style="fill: #0c1c39;" />
            <path
              d="M94.37,117.54c-.12,2.58-.28,5.16-.49,7.73-.49,6.12-1.12,12.25-1.82,18.38-.89,7.76-1.88,15.53-2.94,23.28h8.89c.44-4.2,.87-8.41,1.27-12.61l20.72-12.1c3.41-2.02,6.76-3.9,10.21-6.02,.07,0,.14,.02,.21,.01h.29c.95,.04,1.89,.06,2.82,.06,16.4,0,30.07-5.54,38.7-15.74,22.59-26.69,6.92-59.25,4.86-61.32-1.7-1.71-4.42-1.83-6.26-.29-3.14,2.63-8.19,4.2-13.54,5.86-7.8,2.42-16.65,5.17-22.8,12.22-16.47,18.88-12.02,45.03-9.38,54-2.87,1.49-5.88,2.95-8.78,4.43l-16.03,8.06c.49-5.89,.93-11.8,1.24-17.74,.15-2.82,.24-5.65,.28-8.48,.11-.11,.21-.22,.3-.34,.09-.1,.19-.21,.32-.35,16.29-18.01,23.46-38.4,20.19-57.42C114.47,11.9,66.79-.35,62.85,0c-2.4,.21-4.24,2.21-4.25,4.62,0,6.15-2.95,13.19-6.08,20.65-4.35,10.39-9.28,22.15-7.32,34.65,5.56,35.43,38.54,52.91,49.17,57.62Z"
              style="fill: #0c1c39;" />
          </g>
          <path
            d="M325.13,205.07l-8.95,7.17c-2.36-2.45-4.51-4.28-6.43-5.49-1.92-1.21-4.7-1.81-8.33-1.81-3.97,0-7.19,.9-9.66,2.69-2.47,1.79-3.7,4.1-3.7,6.93,0,2.45,1.08,4.61,3.24,6.49,2.16,1.88,5.83,3.93,11.03,6.16,5.2,2.23,9.24,4.31,12.13,6.23,2.89,1.92,5.27,4.05,7.13,6.37,1.86,2.33,3.24,4.78,4.15,7.36,.91,2.58,1.36,5.31,1.36,8.18,0,6.72-2.44,12.45-7.33,17.19-4.89,4.74-10.8,7.1-17.74,7.1s-12.75-1.85-17.93-5.55c-5.18-3.7-9.17-9.26-11.97-16.66l11.04-3.11c4.02,9.1,10.18,13.65,18.47,13.65,4.02,0,7.36-1.2,10.03-3.61,2.67-2.4,4-5.44,4-9.11,0-2.19-.7-4.4-2.1-6.61-1.4-2.21-3.14-4.04-5.21-5.47-2.08-1.43-5.38-3.08-9.91-4.94-4.53-1.86-8.01-3.56-10.46-5.1s-4.56-3.38-6.34-5.52c-1.78-2.14-3.09-4.26-3.92-6.37-.83-2.12-1.24-4.38-1.24-6.79,0-5.79,2.33-10.73,6.98-14.81,4.65-4.08,10.3-6.12,16.95-6.12,4.4,0,8.86,.95,13.39,2.86,4.53,1.9,8.29,4.8,11.3,8.7Z"
            style="fill: #231815;" />
          <path
            d="M337.63,207.35c0-2.29,.85-4.26,2.54-5.94,1.69-1.67,3.7-2.51,6.03-2.51s4.26,.84,5.94,2.51c1.67,1.67,2.51,3.65,2.51,5.94s-.84,4.32-2.51,5.97c-1.67,1.65-3.65,2.48-5.94,2.48s-4.34-.83-6.03-2.48c-1.69-1.65-2.54-3.64-2.54-5.97Zm3.11,17.2h10.92v52.37h-10.92v-52.37Z"
            style="fill: #231815;" />
          <path
            d="M367.15,276.92v-52.37h10.92v8.06c2.58-3.3,5.05-5.71,7.4-7.24s5.05-2.29,8.09-2.29c3.98,0,7.1,.87,9.36,2.6,2.26,1.74,4.18,4.51,5.74,8.32,2.76-3.81,5.43-6.58,8-8.32,2.57-1.73,5.56-2.6,8.95-2.6,4.16,0,7.75,1.55,10.77,4.67,3.02,3.11,4.52,6.8,4.52,11.08v38.09h-11.04v-35.23c0-5.8-2.87-8.7-8.6-8.7-3.27,0-6.04,1.48-8.31,4.44-2.27,2.96-3.41,6.62-3.41,10.98v28.5h-11.04v-33.77c0-6.86-2.81-10.28-8.44-10.28-3.34,0-6.18,1.4-8.51,4.19-2.33,2.79-3.49,6.24-3.49,10.35v29.52h-10.92Z"
            style="fill: #231815;" />
          <path
            d="M467.32,224.55v10.54c5.28-8,12.04-12,20.28-12,6.76,0,12.58,2.7,17.46,8.09,4.88,5.39,7.32,11.84,7.32,19.33s-2.47,14.11-7.42,19.61c-4.94,5.5-10.78,8.25-17.49,8.25-3.89,0-7.62-1.02-11.19-3.05-3.57-2.03-6.52-4.97-8.84-8.82v34.98h-11.05v-76.93h10.92Zm33.52,25.96c0-4.61-1.73-8.64-5.2-12.09-3.46-3.45-7.54-5.17-12.23-5.17s-8.9,1.71-12.39,5.14-5.23,7.47-5.23,12.12,1.72,8.93,5.16,12.44c3.44,3.51,7.51,5.27,12.2,5.27s9.02-1.73,12.48-5.21c3.46-3.47,5.2-7.64,5.2-12.5Z"
            style="fill: #231815;" />
          <path d="M528.13,194.53h11.04v82.39h-11.04v-82.39Z" style="fill: #231815;" />
          <path
            d="M607.41,252.86h-44.69c.97,5.38,3.18,9.3,6.63,11.77,3.45,2.48,7.21,3.71,11.27,3.71,6.26,0,11.51-2.6,15.74-7.81l8.06,6.09c-6.05,7.83-14.16,11.74-24.31,11.74-7.79,0-14.3-2.67-19.55-8-5.25-5.33-7.87-11.95-7.87-19.87,0-7.41,2.66-13.83,7.97-19.27,5.31-5.44,11.79-8.16,19.46-8.16s13.99,2.76,19.36,8.28c5.37,5.52,8.02,12.69,7.93,21.49Zm-43.54-8.82h31.99c-3.55-7.19-8.8-10.79-15.74-10.79-7.58,0-12.99,3.6-16.25,10.79Z"
            style="fill: #231815;" />
          <path
            d="M618.2,269.5c0-2.33,.83-4.34,2.51-6.03,1.67-1.69,3.69-2.54,6.06-2.54s4.34,.85,6.03,2.54c1.69,1.69,2.54,3.7,2.54,6.03s-.84,4.39-2.51,6.06c-1.67,1.67-3.69,2.51-6.06,2.51s-4.39-.83-6.06-2.48c-1.67-1.65-2.51-3.68-2.51-6.09Z"
            style="fill: #231815;" />
          <path
            d="M646.32,236.01c0-11.67,4.4-21.67,13.2-30,8.8-8.33,19.38-12.5,31.74-12.5s22.45,4.2,31.17,12.59c8.72,8.39,13.08,18.36,13.08,29.91,0,12.22-4.31,22.55-12.92,30.99-8.61,8.44-19.18,12.65-31.71,12.65s-22.87-4.25-31.55-12.75c-8.68-8.5-13.01-18.8-13.01-30.89Zm77.44,.51c0-8.92-3.22-16.43-9.65-22.54-6.43-6.11-14.35-9.16-23.74-9.16s-16.58,3.11-22.95,9.32-9.55,13.68-9.55,22.38,3.27,16.31,9.81,22.42c6.54,6.11,14.55,9.16,24.03,9.16,8.72,0,16.24-3.12,22.57-9.35,6.33-6.24,9.49-13.64,9.49-22.23Z"
            style="fill: #231815;" />
          <path
            d="M799.3,205.07l-8.95,7.17c-2.36-2.45-4.51-4.28-6.43-5.49-1.92-1.21-4.7-1.81-8.33-1.81-3.97,0-7.19,.9-9.66,2.69-2.47,1.79-3.7,4.1-3.7,6.93,0,2.45,1.08,4.61,3.24,6.49,2.16,1.88,5.83,3.93,11.03,6.16s9.24,4.31,12.13,6.23c2.89,1.92,5.27,4.05,7.13,6.37,1.86,2.33,3.24,4.78,4.15,7.36,.91,2.58,1.36,5.31,1.36,8.18,0,6.72-2.44,12.45-7.33,17.19-4.89,4.74-10.8,7.1-17.74,7.1s-12.75-1.85-17.93-5.55c-5.18-3.7-9.17-9.26-11.96-16.66l11.04-3.11c4.02,9.1,10.18,13.65,18.47,13.65,4.02,0,7.36-1.2,10.03-3.61,2.67-2.4,4-5.44,4-9.11,0-2.19-.7-4.4-2.1-6.61-1.4-2.21-3.13-4.04-5.21-5.47-2.08-1.43-5.38-3.08-9.91-4.94-4.53-1.86-8.01-3.56-10.46-5.1-2.44-1.54-4.56-3.38-6.34-5.52s-3.09-4.26-3.92-6.37c-.83-2.12-1.24-4.38-1.24-6.79,0-5.79,2.33-10.73,6.98-14.81,4.65-4.08,10.3-6.12,16.95-6.12,4.4,0,8.87,.95,13.39,2.86,4.53,1.9,8.29,4.8,11.3,8.7Z"
            style="fill: #231815;" />
        </g>
      </svg>
    </div>
    <div id="appdatas">

      <dl v-for="app in appstate">

        <button class="btn btn-primary m-1" @click="selectit(app.app)">
          <dt>{{ app.app }}</dt>
          <dt><img :src="require('@/assets/icons/' + app.app + '.gif')" alt=""></dt>

        </button>
      </dl>
    </div>

    <Body :layout="appstate" :colNum="colNum" @change-layout="changeLayout"></Body>

    <!-- 子要素から親要素へのイベントハンドリング -->
    <Footer @click-toggle-app="add_delete_APP" @click-seiretu="seiretu"></Footer>

  </div>

</template>

<script>
import Footer from './Footer'
import Body from './Body'

import axios from 'axios'

export default {

  name: 'Main',
  data() {
    return {
      appstate: [],
      array: [],
      flg: null,
      stateflg: null,
      colNum: 12
    }
  },
  mounted() {
    let me = this
    axios.get('https://simpleos-api.azurewebsites.net/api/setting_api?', {
      params: {
        name: 'pzmJDkQJF9IDANPfLVBT'
      }
    })
      .then(function (response) {
        console.log(response.data[0])
        me.appstate = response.data[0].AppState
      })
      .catch(function (error) {
        console.log(error)
      })

    document.getElementById('appdatas').style.display = 'none'
    setTimeout(() => {
      document.getElementById('loadingDiv').style.display = 'none'
    }
      , 1000
    )
  },
  methods: {
    selectit(e) {
      let x = 0
      let y = 0
      let w = 12
      let h = 12
      let calc = 1

      document.getElementById('appdatas').style.display = 'none'

      for (let i = 0; i < this.appstate.length; ++i) {
        if (this.appstate[i].app === e) {
          y = 0
        } else {
          y = calc * 12
          calc = calc + 1
        }
        this.$set(this.appstate[i], 'x', x)
        this.$set(this.appstate[i], 'y', y)
        this.$set(this.appstate[i], 'w', w)
        this.$set(this.appstate[i], 'h', h)
      }

      this.stateflg = null
      console.log(this.appstate)
    },
    changeLayout(e) {
      for (let i = 0; i < e.length; ++i) {
        this.$set(this.appstate[i], 'x', e[i].x)
        this.$set(this.appstate[i], 'y', e[i].y)
        this.$set(this.appstate[i], 'w', e[i].w)
        this.$set(this.appstate[i], 'h', e[i].h)
        this.$set(this.appstate[i], 'app', e[i].app)
      }

      console.log('値の変更')
      console.log(this.appstate)
    },
    seiretu() {

      const item = {
        'x': null,
        'y': null,
        'w': null,
        'h': null,
        'i': null,
        'app': null
      }
      this.appstate.push(item)
      this.appstate.splice(-1, 1)

      if (window.matchMedia && window.matchMedia('(max-device-width: 640px)').matches) {
        if (this.stateflg == null) {
          document.getElementById('appdatas').style.display = 'block'
          this.stateflg = 1
        } else {
          document.getElementById('appdatas').style.display = 'none'
        }
      } else {
        if (this.stateflg == null) {
          let y = 0
          let x = 0
          this.array = []
          for (let i = 0; i < this.appstate.length; ++i) {
            const item = {
              'x': this.appstate[i].x,
              'y': this.appstate[i].y,
              'w': this.appstate[i].w,
              'h': this.appstate[i].h,
              'i': this.appstate[i].i,
              'app': this.appstate[i].app
            }

            this.array.push(item)
            console.log('整列保管用array')
            console.log(this.array)
          }

          for (let i = 0; i < this.appstate.length; ++i) {
            if (x === 12) {
              y = y + 12
              x = 0
            }

            this.$set(this.appstate[i], 'x', x)
            this.$set(this.appstate[i], 'y', y)
            this.$set(this.appstate[i], 'w', 3)
            this.$set(this.appstate[i], 'h', 12)
            x = x + 3
          }
          this.stateflg = 1
        } else {
          for (let i = 0; i < this.array.length; ++i) {
            this.$set(this.appstate[i], 'x', this.array[i].x)
            this.$set(this.appstate[i], 'y', this.array[i].y)
            this.$set(this.appstate[i], 'w', this.array[i].w)
            this.$set(this.appstate[i], 'h', this.array[i].h)
          }

          this.stateflg = null
        }
        console.log('最終的な値')
        console.log(this.appstate)
      }
    },
    add_delete_APP(thisapp) {
      this.flg = null

      console.log(thisapp)
      let x = 0
      let y = 0
      let w = 0

      for (let i = 0; i < this.appstate.length; ++i) {
        console.log(this.appstate[i].app)

        if (window.matchMedia && window.matchMedia('(max-device-width: 640px)').matches) {
          x = 0
          y = y + 12
        } else {
          x = x + 4
          if (x === 12) {
            y = y + 12
            x = 0
          }
        }

        if (this.appstate[i].app === thisapp) {
          this.flg = i
        }
      }
      if (window.matchMedia && window.matchMedia('(max-device-width: 640px)').matches) {
        w = 12
      } else {
        w = 4
      }

      const item = {
        'x': x,
        'y': y,
        'w': w,
        'h': 12,
        'i': this.appstate.length + 1,
        'app': thisapp
      }

      // `items`の一番後ろに追加
      console.log(this.flg)
      if (this.flg == null) {
        this.appstate.push(item)
      } else {
        this.appstate.splice(this.flg, 1)
      }

      // { 'x': 0, 'y': 0, 'w': 5, 'h': 20, 'i': '0', 'app': 'Paint' },
      // { 'x': 0, 'y': 2, 'w': 2, 'h': 10, 'i': '1', 'app': 'Seat' },
      // { 'x': 2, 'y': 0, 'w': 2, 'h': 10, 'i': '2', 'app': 'Word' },
      // { 'x': 2, 'y': 2, 'w': 4, 'h': 10, 'i': '3', 'app': 'Info' },
      // { 'x': 4, 'y': 0, 'w': 2, 'h': 10, 'i': '4', 'app': 'Config' },
      // { 'x': 4, 'y': 2, 'w': 2, 'h': 10, 'i': '5', 'app': 'Chat' },
      // { 'x': 6, 'y': 0, 'w': 2, 'h': 10, 'i': '6', 'app': 'Add' },
      // { 'x': 6, 'y': 2, 'w': 2, 'h': 10, 'i': '7', 'app': 'Youtube' }

      console.log(JSON.stringify(this.appstate))
    }
  },
  components: {
    Footer,
    Body
  }
}
</script>

<!--スタイルの指定をします-->
<style scoped>
#main {
  background-color: aliceblue;
}

p {
  line-height: 0px;
  margin: 0;
}

#loadingDiv {
  width: 100vw;
  height: 100vh;
  background-position: center;
  background-color: #fafafa;
  /* background-image: url("../assets/img/movegif.gif"); */
  /* background-repeat: no-repeat; */
}

#logo {
  display: block;
  width: 800px;
  margin: 0 auto 0 auto;
  padding-top: 80px;
}

#logo g path {
  stroke: #1565C0;
  stroke-width: 1px;
  fill: #333;
  stroke-dasharray: 600;
  stroke-dashoffset: 600;
  animation: textAnime 1s linear;
}

@keyframes textAnime {
  0% {
    stroke-dashoffset: 600;
    fill: transparent;
  }

  50% {
    fill: transparent;
  }

  100% {
    stroke-dashoffset: 0;
    fill: #333;
  }
}


#appdatas {
  background-color: aliceblue;
  width: 100vw;
  height: 100vh;
}
</style>
